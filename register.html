<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register - AS Mart</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Registration page specific styles */
        .register-container {
            max-width: 500px;
            margin: 3rem auto;
            padding: 2.5rem;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .register-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .register-header .logo {
            justify-content: center;
            margin-bottom: 1rem;
        }
        
        .progress-bar {
            height: 5px;
            background: #EEE;
            border-radius: 3px;
            margin: 1.5rem 0;
            position: relative;
        }
        
        .progress-fill {
            position: absolute;
            height: 100%;
            background: var(--primary);
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        
        .progress-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
        }
        
        .progress-step {
            text-align: center;
            position: relative;
            z-index: 1;
        }
        
        .step-number {
            width: 30px;
            height: 30px;
            background: white;
            border: 2px solid #DDD;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 0.5rem;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .progress-step.active .step-number {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .step-title {
            font-size: 0.9rem;
            color: #666;
        }
        
        .step-content {
            display: none;
        }
        
        .step-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
        }
        
        .password-strength {
            margin-top: 0.5rem;
        }
        
        .strength-meter {
            height: 5px;
            background: #EEE;
            border-radius: 3px;
            margin-top: 0.5rem;
            overflow: hidden;
        }
        
        .strength-fill {
            height: 100%;
            transition: width 0.3s ease, background 0.3s ease;
        }
        
        .strength-text {
            font-size: 0.8rem;
            color: #666;
        }
        
        .terms-agreement {
            margin: 1.5rem 0;
            padding: 1rem;
            background: #F8F9FA;
            border-radius: 10px;
        }
        
        .referral-section {
            margin: 1.5rem 0;
            padding: 1rem;
            background: #E8F5E9;
            border-radius: 10px;
        }
        
        .referral-code {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .referral-code input {
            flex: 1;
        }
        
        .welcome-bonus {
            text-align: center;
            padding: 1.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 15px;
            margin: 2rem 0;
        }
        
        .bonus-amount {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 0.5rem 0;
        }
        
        .phone-verification {
            margin: 1rem 0;
        }
        
        .phone-input-group {
            display: flex;
            gap: 1rem;
        }
        
        .country-code {
            width: 100px;
        }
        
        .verification-code {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .verification-code input {
            flex: 1;
            text-align: center;
            font-size: 1.5rem;
            letter-spacing: 3px;
        }
        
        .resend-code {
            text-align: center;
            margin-top: 1rem;
        }
        
        .resend-code a {
            color: var(--primary);
            text-decoration: none;
            cursor: pointer;
        }
        
        .registration-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin-top: 3rem;
        }
        
        .feature-card {
            text-align: center;
            padding: 1.5rem;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .feature-card i {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }
        
        .already-have-account {
            text-align: center;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid #EEE;
        }
        
        .already-have-account a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <header>
        <nav class="navbar container">
            <div class="logo">
                <i class="fas fa-bolt"></i>
                <h1>AS <span>Mart</span></h1>
            </div>
            
            <ul class="nav-links">
                <li><a href="index.html"><i class="fas fa-home"></i> Home</a></li>
                <li><a href="shop.html"><i class="fas fa-store"></i> Shop</a></li>
                <li><a href="orders.html"><i class="fas fa-clipboard-list"></i> Orders</a></li>
                <li><a href="tracking.html"><i class="fas fa-map-marker-alt"></i> Track</a></li>
                <li><a href="reviews.html"><i class="fas fa-star"></i> Reviews</a></li>
            </ul>
            
            <div class="nav-right">
                <div class="cart-icon" onclick="location.href='cart.html'">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count">0</span>
                </div>
                <div class="user-profile">
                    <div class="user-avatar">G</div>
                    <span>Guest</span>
                </div>
            </div>
        </nav>
    </header>

    <main class="container">
        <div class="register-container">
            <div class="register-header">
                <div class="logo">
                    <i class="fas fa-bolt" style="color: var(--primary); font-size: 2rem;"></i>
                    <h1 style="font-size: 2rem;">AS <span>Mart</span></h1>
                </div>
                <h2>Create Your Account</h2>
                <p>Join AS Mart for faster deliveries and exclusive benefits</p>
            </div>
            
            <!-- Welcome Bonus -->
            <div class="welcome-bonus">
                <h3>Welcome Bonus!</h3>
                <div class="bonus-amount">$20 OFF</div>
                <p>Get $20 off on your first order + Free Delivery for 30 days</p>
            </div>
            
            <!-- Progress Bar -->
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 33%"></div>
            </div>
            
            <div class="progress-steps">
                <div class="progress-step active">
                    <div class="step-number">1</div>
                    <div class="step-title">Basic Info</div>
                </div>
                <div class="progress-step">
                    <div class="step-number">2</div>
                    <div class="step-title">Verify Phone</div>
                </div>
                <div class="progress-step">
                    <div class="step-number">3</div>
                    <div class="step-title">Complete</div>
                </div>
            </div>
            
            <!-- Step 1: Basic Information -->
            <div class="step-content active" id="step1">
                <form id="basicInfoForm">
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" class="form-control" id="fullName" 
                               placeholder="Enter your full name" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Email Address</label>
                        <input type="email" class="form-control" id="email" 
                               placeholder="Enter your email" required>
                        <div class="email-availability" id="emailAvailability" 
                             style="font-size: 0.8rem; margin-top: 0.3rem;"></div>
                    </div>
                    
                    <div class="form-group">
                        <label>Phone Number</label>
                        <div class="phone-input-group">
                            <select class="form-control country-code">
                                <option>+1 (US)</option>
                                <option>+44 (UK)</option>
                                <option>+91 (IN)</option>
                                <option>+61 (AU)</option>
                            </select>
                            <input type="tel" class="form-control" id="phone" 
                                   placeholder="Phone number" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Password</label>
                        <div class="password-toggle">
                            <input type="password" class="form-control" id="password" 
                                   placeholder="Create a password" required 
                                   oninput="checkPasswordStrength()">
                            <i class="fas fa-eye" id="togglePassword" 
                               onclick="togglePasswordVisibility('password')"></i>
                        </div>
                        
                        <div class="password-strength">
                            <div class="strength-meter">
                                <div class="strength-fill" id="passwordStrengthFill"></div>
                            </div>
                            <div class="strength-text" id="passwordStrengthText">
                                Password strength: None
                            </div>
                        </div>
                        
                        <ul style="font-size: 0.8rem; color: #666; margin-top: 0.5rem; padding-left: 1.2rem;">
                            <li>At least 8 characters</li>
                            <li>One uppercase letter</li>
                            <li>One number</li>
                            <li>One special character</li>
                        </ul>
                    </div>
                    
                    <div class="form-group">
                        <label>Confirm Password</label>
                        <div class="password-toggle">
                            <input type="password" class="form-control" id="confirmPassword" 
                                   placeholder="Confirm password" required>
                            <i class="fas fa-eye" onclick="togglePasswordVisibility('confirmPassword')"></i>
                        </div>
                        <div class="password-match" id="passwordMatch" 
                             style="font-size: 0.8rem; margin-top: 0.3rem;"></div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="goToLogin()">
                            Back to Login
                        </button>
                        <button type="button" class="btn btn-primary" onclick="nextStep()">
                            Continue <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Step 2: Phone Verification -->
            <div class="step-content" id="step2">
                <div class="phone-verification">
                    <h3>Verify Your Phone</h3>
                    <p>We've sent a 6-digit verification code to your phone number</p>
                    
                    <div class="verification-code">
                        <input type="text" class="form-control" id="digit1" maxlength="1" 
                               oninput="moveToNext(this, 'digit2')">
                        <input type="text" class="form-control" id="digit2" maxlength="1" 
                               oninput="moveToNext(this, 'digit3')">
                        <input type="text" class="form-control" id="digit3" maxlength="1" 
                               oninput="moveToNext(this, 'digit4')">
                        <input type="text" class="form-control" id="digit4" maxlength="1" 
                               oninput="moveToNext(this, 'digit5')">
                        <input type="text" class="form-control" id="digit5" maxlength="1" 
                               oninput="moveToNext(this, 'digit6')">
                        <input type="text" class="form-control" id="digit6" maxlength="1" 
                               oninput="verifyCode()">
                    </div>
                    
                    <div class="resend-code">
                        <p>Didn't receive the code? 
                            <a href="#" onclick="resendCode()" id="resendLink">Resend</a>
                            <span id="countdown">(60s)</span>
                        </p>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="previousStep()">
                            <i class="fas fa-arrow-left"></i> Back
                        </button>
                        <button type="button" class="btn btn-primary" onclick="skipVerification()">
                            Skip for Now
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Step 3: Complete Registration -->
            <div class="step-content" id="step3">
                <div style="text-align: center; padding: 2rem 0;">
                    <div style="font-size: 4rem; color: var(--success); margin-bottom: 1rem;">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h3>Registration Complete!</h3>
                    <p>Welcome to AS Mart! Your account has been created successfully.</p>
                    
                    <div class="referral-section">
                        <h4>Invite Friends & Earn Rewards</h4>
                        <p>Share your referral code and earn $10 for each friend who signs up</p>
                        <div class="referral-code">
                            <input type="text" class="form-control" id="referralCode" 
                                   value="ASMART20" readonly>
                            <button class="btn btn-primary" onclick="copyReferralCode()">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                        </div>
                    </div>
                    
                    <div class="terms-agreement">
                        <label style="display: flex; align-items: flex-start; gap: 0.5rem;">
                            <input type="checkbox" id="marketingEmails" checked>
                            <span style="font-size: 0.9rem;">
                                I want to receive promotional emails, exclusive offers, 
                                and updates from AS Mart
                            </span>
                        </label>
                    </div>
                    
                    <button class="btn btn-success btn-block" onclick="completeRegistration()">
                        <i class="fas fa-rocket"></i> Start Shopping Now!
                    </button>
                </div>
            </div>
            
            <!-- Terms and Conditions -->
            <div class="terms-agreement">
                <label style="display: flex; align-items: flex-start; gap: 0.5rem;">
                    <input type="checkbox" id="termsAgreement" required>
                    <span style="font-size: 0.9rem;">
                        By creating an account, I agree to AS Mart's 
                        <a href="#" style="color: var(--primary);">Terms of Service</a> and 
                        <a href="#" style="color: var(--primary);">Privacy Policy</a>
                    </span>
                </label>
            </div>
            
            <div class="already-have-account">
                <p>Already have an account? <a href="login.html">Sign in here</a></p>
            </div>
        </div>
        
        <div class="registration-features">
            <div class="feature-card">
                <i class="fas fa-bolt"></i>
                <h3>20-Minute Guarantee</h3>
                <p>Get anything delivered in just 20 minutes</p>
            </div>
            <div class="feature-card">
                <i class="fas fa-gift"></i>
                <h3>Welcome Bonus</h3>
                <p>$20 off on your first order</p>
            </div>
            <div class="feature-card">
                <i class="fas fa-star"></i>
                <h3>Exclusive Rewards</h3>
                <p>Earn points on every order</p>
            </div>
            <div class="feature-card">
                <i class="fas fa-shield-alt"></i>
                <h3>Secure Payments</h3>
                <p>Your payment information is safe with us</p>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>AS Mart</h3>
                    <p>Your trusted 20-minute delivery partner for all daily needs.</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul class="footer-links">
                        <li><a href="shop.html">Shop Now</a></li>
                        <li><a href="orders.html">My Orders</a></li>
                        <li><a href="tracking.html">Track Order</a></li>
                        <li><a href="reviews.html">Leave Review</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Contact Us</h3>
                    <p><i class="fas fa-phone"></i> +1 234 567 890</p>
                    <p><i class="fas fa-envelope"></i> support@asmart.com</p>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2024 AS Mart. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Email Verification Modal -->
    <div id="emailVerifyModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('emailVerifyModal')">&times;</span>
            <div style="text-align: center; padding: 2rem;">
                <div style="font-size: 4rem; color: var(--primary); margin-bottom: 1rem;">
                    <i class="fas fa-envelope"></i>
                </div>
                <h3>Verify Your Email</h3>
                <p>We've sent a verification link to your email address.</p>
                <p>Please check your inbox and click the link to verify your account.</p>
                <button class="btn btn-primary" onclick="closeModal('emailVerifyModal')">
                    OK
                </button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="js/firebase-config.js"></script>
    <script src="js/auth.js"></script>
    <script>
        // Registration functionality
        let currentStep = 1;
        let userData = {};
        let verificationTimer;
        let countdown = 60;
        
        document.addEventListener('DOMContentLoaded', function() {
            // Check password match
            document.getElementById('confirmPassword').addEventListener('input', checkPasswordMatch);
            
            // Check email availability
            document.getElementById('email').addEventListener('blur', checkEmailAvailability);
            
            // Setup verification code inputs
            setupVerificationInputs();
            
            // Initialize countdown
            startCountdown();
            
            // Update cart count
            updateCartCount();
        });
        
        function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            document.querySelector('.cart-count').textContent = cart.reduce((total, item) => total + item.quantity, 0);
        }
        
        function goToLogin() {
            window.location.href = 'login.html';
        }
        
        function nextStep() {
            // Validate current step
            if (!validateStep(currentStep)) {
                return;
            }
            
            // Save step data
            saveStepData(currentStep);
            
            // Move to next step
            currentStep++;
            
            // Update UI
            updateProgress();
            
            // If moving to step 2 (verification), send verification code
            if (currentStep === 2) {
                sendVerificationCode();
            }
        }
        
        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                updateProgress();
            }
        }
        
        function updateProgress() {
            // Update progress bar
            const progress = (currentStep / 3) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            
            // Update step indicators
            document.querySelectorAll('.progress-step').forEach((step, index) => {
                step.classList.toggle('active', index < currentStep);
            });
            
            // Show current step content
            document.querySelectorAll('.step-content').forEach((content, index) => {
                content.classList.toggle('active', (index + 1) === currentStep);
            });
        }
        
        function validateStep(step) {
            switch(step) {
                case 1:
                    const fullName = document.getElementById('fullName').value.trim();
                    const email = document.getElementById('email').value.trim();
                    const phone = document.getElementById('phone').value.trim();
                    const password = document.getElementById('password').value;
                    const confirmPassword = document.getElementById('confirmPassword').value;
                    const termsAgreed = document.getElementById('termsAgreement').checked;
                    
                    if (!fullName) {
                        showMessage('Please enter your full name', 'error');
                        return false;
                    }
                    
                    if (!email || !validateEmail(email)) {
                        showMessage('Please enter a valid email address', 'error');
                        return false;
                    }
                    
                    if (!phone || !validatePhone(phone)) {
                        showMessage('Please enter a valid phone number', 'error');
                        return false;
                    }
                    
                    if (!password) {
                        showMessage('Please enter a password', 'error');
                        return false;
                    }
                    
                    if (password.length < 8) {
                        showMessage('Password must be at least 8 characters', 'error');
                        return false;
                    }
                    
                    if (password !== confirmPassword) {
                        showMessage('Passwords do not match', 'error');
                        return false;
                    }
                    
                    if (!termsAgreed) {
                        showMessage('Please agree to the Terms and Conditions', 'error');
                        return false;
                    }
                    
                    return true;
                    
                case 2:
                    // Skip verification for demo
                    return true;
                    
                default:
                    return true;
            }
        }
        
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }
        
        function validatePhone(phone) {
            const re = /^[0-9]{10}$/;
            return re.test(phone);
        }
        
        function saveStepData(step) {
            switch(step) {
                case 1:
                    userData.fullName = document.getElementById('fullName').value.trim();
                    userData.email = document.getElementById('email').value.trim();
                    userData.phone = document.getElementById('phone').value.trim();
                    userData.password = document.getElementById('password').value;
                    break;
            }
        }
        
        function checkPasswordStrength() {
            const password = document.getElementById('password').value;
            const strengthFill = document.getElementById('passwordStrengthFill');
            const strengthText = document.getElementById('passwordStrengthText');
            
            let strength = 0;
            let color = '#FF4444'; // Red
            
            // Length check
            if (password.length >= 8) strength += 25;
            
            // Uppercase check
            if (/[A-Z]/.test(password)) strength += 25;
            
            // Number check
            if (/[0-9]/.test(password)) strength += 25;
            
            // Special character check
            if (/[^A-Za-z0-9]/.test(password)) strength += 25;
            
            // Update UI
            strengthFill.style.width = strength + '%';
            
            if (strength <= 25) {
                strengthText.textContent = 'Password strength: Weak';
                strengthFill.style.background = '#FF4444';
            } else if (strength <= 50) {
                strengthText.textContent = 'Password strength: Fair';
                strengthFill.style.background = '#FFA500';
            } else if (strength <= 75) {
                strengthText.textContent = 'Password strength: Good';
                strengthFill.style.background = '#FFCC00';
            } else {
                strengthText.textContent = 'Password strength: Strong';
                strengthFill.style.background = '#00C851';
            }
        }
        
        function checkPasswordMatch() {
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const matchDiv = document.getElementById('passwordMatch');
            
            if (!confirmPassword) {
                matchDiv.textContent = '';
                matchDiv.style.color = '';
                return;
            }
            
            if (password === confirmPassword) {
                matchDiv.textContent = '✓ Passwords match';
                matchDiv.style.color = 'var(--success)';
            } else {
                matchDiv.textContent = '✗ Passwords do not match';
                matchDiv.style.color = 'var(--danger)';
            }
        }
        
        function checkEmailAvailability() {
            const email = document.getElementById('email').value.trim();
            const availabilityDiv = document.getElementById('emailAvailability');
            
            if (!email || !validateEmail(email)) {
                availabilityDiv.textContent = '';
                return;
            }
            
            // Check if email exists in Firebase
            firebase.auth().fetchSignInMethodsForEmail(email)
                .then((signInMethods) => {
                    if (signInMethods.length > 0) {
                        availabilityDiv.textContent = '✗ Email already registered';
                        availabilityDiv.style.color = 'var(--danger)';
                    } else {
                        availabilityDiv.textContent = '✓ Email available';
                        availabilityDiv.style.color = 'var(--success)';
                    }
                })
                .catch((error) => {
                    console.error('Error checking email:', error);
                });
        }
        
        function togglePasswordVisibility(fieldId) {
            const input = document.getElementById(fieldId);
            const icon = event.target;
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }
        
        function setupVerificationInputs() {
            // Auto-focus first input
            document.getElementById('digit1').focus();
        }
        
        function moveToNext(current, nextId) {
            if (current.value.length === 1) {
                document.getElementById(nextId).focus();
            }
        }
        
        function sendVerificationCode() {
            // In a real app, send SMS verification code
            showMessage('Verification code sent to your phone', 'success');
            startCountdown();
        }
        
        function startCountdown() {
            clearInterval(verificationTimer);
            countdown = 60;
            updateCountdown();
            
            verificationTimer = setInterval(() => {
                countdown--;
                updateCountdown();
                
                if (countdown <= 0) {
                    clearInterval(verificationTimer);
                    document.getElementById('resendLink').style.display = 'inline';
                    document.getElementById('countdown').style.display = 'none';
                }
            }, 1000);
        }
        
        function updateCountdown() {
            document.getElementById('countdown').textContent = `(${countdown}s)`;
            if (countdown > 0) {
                document.getElementById('resendLink').style.display = 'none';
                document.getElementById('countdown').style.display = 'inline';
            }
        }
        
        function resendCode() {
            sendVerificationCode();
            document.getElementById('resendLink').style.display = 'none';
            document.getElementById('countdown').style.display = 'inline';
        }
        
        function verifyCode() {
            // Get verification code
            const code = 
                document.getElementById('digit1').value +
                document.getElementById('digit2').value +
                document.getElementById('digit3').value +
                document.getElementById('digit4').value +
                document.getElementById('digit5').value +
                document.getElementById('digit6').value;
            
            if (code.length === 6) {
                // In a real app, verify with Firebase
                nextStep();
            }
        }
        
        function skipVerification() {
            nextStep();
        }
        
        function completeRegistration() {
            // Create user in Firebase
            firebase.auth().createUserWithEmailAndPassword(userData.email, userData.password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    
                    // Update profile
                    user.updateProfile({
                        displayName: userData.fullName
                    });
                    
                    // Send email verification
                    user.sendEmailVerification();
                    
                    // Save additional user data to Firestore
                    return db.collection('users').doc(user.uid).set({
                        uid: user.uid,
                        email: userData.email,
                        name: userData.fullName,
                        phone: userData.phone,
                        emailVerified: false,
                        phoneVerified: false,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
                        walletBalance: 20.00, // Welcome bonus
                        referralCode: generateReferralCode(),
                        marketingEmails: document.getElementById('marketingEmails').checked
                    });
                })
                .then(() => {
                    // Show success and redirect
                    showMessage('Account created successfully!', 'success');
                    
                    setTimeout(() => {
                        // Show email verification modal
                        document.getElementById('emailVerifyModal').style.display = 'flex';
                        
                        // Redirect to home after delay
                        setTimeout(() => {
                            window.location.href = 'index.html';
                        }, 3000);
                    }, 1000);
                })
                .catch((error) => {
                    console.error('Registration error:', error);
                    
                    let errorMessage = 'Registration failed. ';
                    switch(error.code) {
                        case 'auth/email-already-in-use':
                            errorMessage += 'Email already registered.';
                            break;
                        case 'auth/invalid-email':
                            errorMessage += 'Invalid email address.';
                            break;
                        case 'auth/operation-not-allowed':
                            errorMessage += 'Registration is currently disabled.';
                            break;
                        case 'auth/weak-password':
                            errorMessage += 'Password is too weak.';
                            break;
                        default:
                            errorMessage += error.message;
                    }
                    
                    showMessage(errorMessage, 'error');
                });
        }
        
        function generateReferralCode() {
            return 'ASMART' + Math.random().toString(36).substr(2, 6).toUpperCase();
        }
        
        function copyReferralCode() {
            const referralCode = document.getElementById('referralCode');
            referralCode.select();
            document.execCommand('copy');
            showMessage('Referral code copied!', 'success');
        }
        
        function showMessage(message, type) {
            // Similar to login page message function
            alert(message); // Simplified for demo
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
    </script>
</body>
</html>